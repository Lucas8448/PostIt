<!DOCTYPE html>
<html>

<head>
  <title>WebRTC Client</title>
  <script>
    let peerConnection = new RTCPeerConnection();

    peerConnection.onicecandidate = event => {
      if (event.candidate) {
        console.log("New ICE candidate:", event.candidate);
      }
    };

    peerConnection.oniceconnectionstatechange = () => {
      console.log("ICE connection state changed to:", peerConnection.iceConnectionState);
    };

    peerConnection.onconnectionstatechange = () => {
      console.log("Connection state changed to:", peerConnection.connectionState);
    };

    peerConnection.ondatachannel = event => {
      const dataChannel = event.channel;
      dataChannel.onopen = () => console.log("Connected to host");
      dataChannel.onmessage = e => console.log("Message from Host:", e.data);
      dataChannel.onerror = error => console.error("Data channel error:", error);
      dataChannel.onclose = () => console.log("Data channel closed");
    };

    window.onload = () => {
      const urlParams = new URLSearchParams(window.location.search);
      const offerSdp = atob(decodeURIComponent(urlParams.get('offer')));
      const offerDesc = new RTCSessionDescription({
        type: 'offer',
        sdp: offerSdp
      });

      peerConnection.setRemoteDescription(offerDesc)
        .then(() => peerConnection.createAnswer())
        .then(answer => peerConnection.setLocalDescription(answer))
        .catch(error => console.error("Error during answer creation:", error));
    };
  </script>
</head>

<body>
  <h2>WebRTC Client</h2>
  <p>Connecting to Host...</p>
</body>

</html>